---
title: 架构分层
date: 2021-02-02 19:46:33
tags:
- 高并发
- 架构
category: 高并发
---

在系统从0到1的阶段，为了能让系统快速上线， 我们通常不考虑分层。 但是随着业务系统越来越庞大，就会出现大量代码纠缠在一起，出现逻辑混乱，
各模块互相依赖，代码扩展性差，改一处而动全身等问题。
<br/>
这时，就要思考分层的问题了

### 什么是分层架构

软件架构分层是将整体系统拆分成N个层次，每个层级有独立的职责，多个层次协助完成的功能。例如MVC
就是一种标准的软件分层框架。另外一种常见的分层方式是将整体架构分为<strong>表现层，逻辑层和数据访问层</strong>。

+ 表现层，顾名思义就是展示数据结果和接受用户指令的，最接近用户的一层
+ 逻辑层里面是业务逻辑（Biz/Service）
+ 数据访问层则是主要处理和存储之间的交互（DAO）

除此之外，OSI网络模型把整个网络分成了7层，从上到下分别是：
+ 应用层
+ 表示层
+ 会话层
+ 传输层
+ 网络层
+ 数据链路层
+ 物理层

工作中经常用到的TCP/IP协议则从上到下分成了4层：
+ 应用层（1-3）
+ 传输层（4）
+ 网络层（5）
+ 数据链路层（6-7）

其中网络层负责端到端的寻址和建立连接，传输层负责端到端的数据传输。

除此之外，Linux文件系统也是分层设计的。

### 分层的好处
+ 分层的设计可以简化西戎设计，让不同的人专注做某一层次的事情。一件事交给一层做，其他的都交给其他几层完成。
+ 另外，分层之后可以有很高的复用性。
+ 最后， 分层架构可以让我们更容易横向扩展。例如，业务逻辑里包含复杂的计算导致CPU性能成为瓶颈。那我们就可以把逻辑层单独抽出来独立部署，然
  后只对逻辑层进行扩展。这样代价就小多了。
  
### 如何做分层
我们以阿里巴巴Java开发手册v1.4为例。可以将原来的三层结构分为：

![阿里系统分层的规约](http://m.qpic.cn/psc?/V51lIF8R3HS9sa4GVlzK1thDGf39F65U/45NBuzDIW489QBoVep5mcfVIou1pXmXE3kaaVitURi7uaHYP6gqgzabWcfOV3tKohPuAAKQtB0h1fyjqnPO6cDUTL.Z6NWTIVpLNt.9XO4M!/b&bo=dgSQAwAAAAADJ.M!&rf=viewer_4
"阿里系统分层的规约")


+ 终端显示曾：各端模板渲染并执行显示的层，主要是Velocity，JS，JSP，移动端渲染展示。
+ 开放接口层： 将Service层方法封装成开放接口，同时进行网管安全控制和<font color="dd0000">流量控制</font>等.
+ Web层： 主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。
+ Service层： 业务逻辑层
+ Manager层： 通用业务处理曾，这一层的作用有两个，一， 可将Service层的一些通用能力下沉到这一层，比如缓存和存储交互策略，
中间件接入：二， 也可以封装对第三方接口的调用，比如支付或者审核等服务
+ DAO层： 数据访问层， 与MySQL，Oracle，Hbase等进行数据交互
+ 外部接口或第三方平台： 包括其他部门的RPC开放接口，基础平台，其他公司的HTTP接口。

这里面主要增加了Manager层，他其实就是更细化，更原子性的服务接口，而Service层负责依据业务逻辑编排原子接口。
注意！层次之间一定是相邻互相以来的，数据的流转也只能在相邻的两层之间流转。

另外，哪怕一个案例中不需要业务层，直接操作DAO层就可以，那我们也不能直接这么做，否则以后的维护就会便的苦难。

### 分层架构的不足
最大的缺点就是增加了代码的复杂性。另外，如果每个层次独立部署，那么层次之间通过网络来交互，那么多层的架构在性能上就会有损耗。







